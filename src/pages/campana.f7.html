<template>
<div class="page" data-name="campana" data-campana="{{campana.nombre}}" data-campanaid="{{campana.id}}" id="campana">
  <div class="navbar">
    <div class="navbar-bg"></div>
    <div class="navbar-inner sliding">
      <div class="left">
        <a href="#" class="link back">
          <!-- <i class="icon icon-back"></i> -->
          <span class="material-icons">
            close
            </span>
          <!-- <span class="if-not-md">Back</span> -->
        </a>
      </div>
      <!-- <div class="title">{{campana.nombre}}</div> -->
    </div>
  </div>
  <div class="page-content">
    
    <div class="logo">
      <img src="/static/logo_white.svg" alt="">
    </div>
    <div class="title">{{campana.nombre}}</div>
    <div data-pagination='{"el": ".swiper-pagination"}' data-space-between="10" data-slides-per-view="1.5" data-centered-slides="true" class="swiper-container swiper-init ">
      <div class="swiper-wrapper">
        {{#each paquetes}}
        <div class="swiper-slide paquete">
          {{#if icono}}
          <img src="{{icono.data.full_url}}" alt="" class="icono">
          {{else}}
          <span class="material-icons icono">
            star
            </span>
          {{/if}}
          <div class="card ">

            <div class="card-content card-content-padding">
              <p class="descripcion">{{descripcion}}</p>
              <p class="nombre">{{nombre}}</p>
              <p class="precio donacion" data-donacion="{{cantidad}}">MXN ${{cantidad}}</p>
              
            </div>
          </div>



         
        </div>
        {{/each}}
        <div class="swiper-slide paquete">
          
          
          <span class="material-icons icono">
            star
            </span>
          
          <div class="card set-price">

            <div class="card-content card-content-padding">
              <p class="descripcion">¿Cuánto?</p>
              <p class="nombre">Tu decides</p>
              <p class="precio personalizado donacion" data-donacion="">MXN $<span class="custom-price">0</span>.00 <i class="f7-icons" >pencil</i></p>
            </div>
          </div>




        </div>
        
      </div>
    </div>
    <div class="row no-gap">
      <div class="col-20"></div>
      <div class="col-60">
        <a class="button button-raised  button-fill button-large link donar" data-force="true" data-ignore-cache="true" data-view=".view-main" href="">Donar</a>
        <!-- <a class="button button-raised  button-fill button-large link external donar" data-force="true" data-ignore-cache="true" data-view=".view-main" href="https://pay.conekta.com/link/b4cfa5543f104e3981f36246efea87ce">Donar</a> -->

      </div>
      
      <div class="col-20"></div>
    </div>
    <div class="footer">
      <img src="/static/footer.svg" alt="" width="100%" height="auto">
    </div>
  </div>
</div>

</template>
<script>
  import $$ from 'dom7';
export default {

 
  on: {
    pageMounted: function(e, page) {
      // const curl = new (require( 'curl-request' ))();
      var self = this;
      var app = self.$app;

      // app.request.setup({
      //   headers: {
      //     'accept': 'application/vnd.conekta-v2.0.0+json',
      //     'autorization': app.data.token,
      //     'cache-control': 'no-cache',
      //     'content-type': 'application/json',
      //     'Access-Control-Allow-Origin': '*'
      //   },
      //   crossDomain: true

      
      // });
      $$('.set-price').on('click', function () {
        app.dialog.prompt('','Ingresa la cantidad a donar:', function (price) {
          $$('.set-price .donacion').data('donacion',price);
          $$('.custom-price').html(price);
        

        });
      });

       
      // $$('a.donar').on('click', function(e){
      //   e.preventDefault();
      //   curl
      // .setHeaders([
      //     'user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36',
      //     'accept: application/vnd.conekta-v2.0.0+json',
      //     'access-control-allow-origin: *',
      //     'authorization: Basic a2V5XzZ2VjJ6Mkh5SjdOS3hNcWU1cmJlcVE6',
      //     'cache-control: no-cache',
      //     'content-type: application/json'
      // ])
      // .setBody({
      //   "name": "Donación Anónima",
      //   "type": "PaymentLink",
      //   "recurrent": false,
      //   "expired_at": 1595221200,
      //   "allowed_payment_methods": [
      //     "cash",
      //     "card"
      //   ],
      //   "needs_shipping_contact": false,
      //   "order_template": {
      //     "line_items": [
      //         {
      //       "name": "Amigos de la Sierra",
      //       "description": "Donacion",
      //   "unit_price": 10000,
      //       "quantity": 1
      //         }
      //     ],
      //     "currency": "MXN",
      //     "customer_info": {
      //         "name": "Donador Anónimo",
      //                   "email": "administracion@amigosdelasierra.org",
      //                   "phone": "2147483647"
      //     }
      //   }
      // })
      // .post('https://api.conekta.io/checkouts')
      // .then(({statusCode, body, headers}) => {
      //     console.log(statusCode, body, headers)
      // })
      // .catch((e) => {
      //     console.log(e);
      // });
      // });
      

      $$('a.donar').on('click', function(e){
        e.preventDefault();
        var cantidadDonada = $$('.swiper-slide-active .donacion').data('donacion');
        var donacion = cantidadDonada*100;
        var campanaName = $$('.page').data('campana');
        var campanaId = $$('.page').data('campanaid');
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        var expiration_date = tomorrow.getTime();
        
        app.request.setup({
          headers: {
            "accept": "application/json, text/plain, */*",
            "accept-language": "es,en-US;q=0.9,en;q=0.8",
            "authorization": "Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IjQ0QjIwNTMxQTU1MEMyQjkwNTRBNEYzNDNCREY2OTlGMDA4NzExMDYiLCJ0eXAiOiJhdCtqd3QiLCJ4NXQiOiJSTElGTWFWUXdya0ZTazgwTzk5cG53Q0hFUVkifQ.eyJuYmYiOjE1OTMxOTIyNzYsImV4cCI6MTU5MzIwMzA3NiwiaXNzIjoiaHR0cHM6Ly9pZGVudGl0eS5jb25la3RhLmNvbSIsImF1ZCI6WyJjcGFuZWwtZ2F0ZXdheS1hcGkiLCJvbmJvYXJkaW5nLWdhdGV3YXktYXBpIl0sImNsaWVudF9pZCI6ImY1MDhiYjg1LTExODgtNGMwOC1iZWIzLWEwNzZlMWQ0MWY5ZSIsInN1YiI6IjNiZTEwYjJkLTY2NzYtNGRhMC1iOWM1LTU3YTJlYjVmZDBiMiIsImF1dGhfdGltZSI6MTU5MzE5MjI3NiwiaWRwIjoibG9jYWwiLCJzdGF0dXMiOiIxIiwic2NvcGUiOlsib3BlbmlkIiwicHJvZmlsZSIsInN0YXR1cyIsImNwYW5lbC1nYXRld2F5LWFwaSIsIm9uYm9hcmRpbmctZ2F0ZXdheS1hcGkiXSwiYW1yIjpbInB3ZCJdfQ.w5khXW0S4JaQj5SDFuyRAfJznzCjxT_iiRL-WUbfM3IKGeXy7pNEeAQcOwbN5ffSwZpiSxcX47mxWoDXyOS4besUDBbTKxEAUqwgWwWgdFFi3hVETDvmLu_Av-2p3oZgsQ0cHz-Xw23siWBuj3Lr6M8BdpUzlWM84xRtNAiG5vZkaX7Tzeu42LP1fatwaDPx2lgEsbl87CG97gfkQ1eqc8Te4dmT8mdY2Yh89glC-aYZRDc5nDSTmZCPoGuNIPMAFaaw9fZJUaftLEPmMYC0moIAtEtnoKoPKun_MX2XwQDmm-QsBr_nZSqRWh39XwX2tXgU86BxT9DQF6WMKEpcIH131bkdXyXv1tv0XnzY-vMK5jPz0eo9mGQ5k2MtqHWETmM6azasmsqqWgHK6-O3RN7DzlXoPRfR7m4czAPSrGING0JK-HtBm6GM9dNY5WE2LB1s6UOTtj-ooi6Awd69Xpnr4qqWaa6VvvNOe8uTiSuPcKPW7RFJWoGoQ-yJNg0v2z71bnl15ghTjLFHE6_4n8ipAU4mtpQ5gsPEyI_ZMqYBy8fBN7CHWoXdqW1gcixOm3MT-AOFK-vTk9CFhy4xfXBvRLgOIfov3gxwWvZMfA0sPlwLrKcU1tp5wkzrbC5jiT0ryYJ0-eKgEEM_uWkItGjIapfp7N5B3ExZYBqbl2w",
            "companyid": "",
            "content-type": "application/json",
            "entityid": "", 
            "idempotencykey": "2d1df479b245ee0527f35805471343071593125790556",
            "sec-fetch-dest": "empty",
            "sec-fetch-mode": "cors",
            "sec-fetch-site": "same-site",
            "serviceorigin": "PaymentLink",
            "userid": "3be10b2d-6676-4da0-b9c5-57a2eb5fd0b2"
          }
        });

        app.request.promise.postJSON('https://p_back.conekta.com/v1/checkout-service/checkout-requests', 
        {"allowedPaymentMethods":["Cash","Card","BankTransfer"],"amount":donacion,"companyId":"5ec30659629b2b0001f737b3","entityId":"4fefd8f2-426e-4b15-8d8b-851d6ef1a590","expiredDays":2,"name": campanaName,"needsShippingContact":false,"orderTemplate":{"lineItems":[{"name":campanaName,"unitPrice":donacion,"quantity":1}],"currency":"MXN","customerInfo":{"name":"Donador Anónimo","email":"administracion@amigosdelasierra.org"}},"quantity":1,"recurrent":false,"type":"PaymentLink","origin":"Panel"}

        )
        .then(function (res) {
          console.log(res.data);
        });
       

      });
    },
    pageInit: function(e, page) {

    },
    pageBeforeIn: function(e, page) {
      // Get all videos.

    },
    pageAfterIn: function(e, page) {
      

    },
    pageBeforeOut: function(e, page) {
    },
    pageAfterOut: function(e, page) {
    },
    pageBeforeRemove: function(e, page) {
    },
  }
};
</script>